
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Defining Relationships &#8212; OpenAlchemy 0.2.0 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Inheritance" href="inheritance.html" />
    <link rel="prev" title="References" href="references.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="defining-relationships">
<span id="relationship"></span><h1>Defining Relationships<a class="headerlink" href="#defining-relationships" title="Permalink to this headline">¶</a></h1>
<p>Defining relationships between tables is done by using <em>$ref</em> to reference
other objects from an object property.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference external" href="https://docs.sqlalchemy.org/en/13/orm/basic_relationships.html">SQLAlchemy relationship documentation</a></dt><dd><p>Documentation for SQLAlchemy relationships.</p>
</dd>
</dl>
</div>
<div class="section" id="many-to-one">
<span id="id1"></span><h2>Many to One<a class="headerlink" href="#many-to-one" title="Permalink to this headline">¶</a></h2>
<p>A many to one relationship associates many children with a single parent. For
example, a company can have many employees working in the same division (for
example engineering, legal, marketing, …) but a particular employee can only
work in one division. In this case the employees are the parents on the “many”
side and the division is the child on the “one” side. The following <em>OpenAPI</em>
specification snippet defines a many to one relationship:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">Division</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="nt">Employee</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="l l-Scalar l-Scalar-Plain">division</span><span class="p p-Indicator">:</span>
      <span class="s">&quot;$ref&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;#/components/schemas/Division&quot;</span>
</pre></div>
</td></tr></table></div>
<p>By adding a <em>$ref</em> to an object property that points at another object, a
relationship with the logical name will be formed. For example, if the <em>$ref</em>
points to the <em>Division</em> object, <em>sqlalchemy.orm.relationship</em> with
<em>“Division”</em> will be called.</p>
<p>Alongside the <em>relationship</em>, a foreign key will also be added to the table
with the <em>$ref</em> property under the name of the property suffixed with <em>_id</em>.
Note that, the object being referenced must have the <em>id</em> property.</p>
<p>The only way to make the foreign key column not nullable is to add the
property with the reference to the <em>required</em> list. For example:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">Division</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="nt">Employee</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="l l-Scalar l-Scalar-Plain">division</span><span class="p p-Indicator">:</span>
      <span class="s">&quot;$ref&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;#/components/schemas/Division&quot;</span>
  <span class="nt">required</span><span class="p">:</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="l l-Scalar l-Scalar-Plain">- division</span>
</pre></div>
</td></tr></table></div>
<p>OpenAlchemy defined relationships are equivalent to the following traditional
<em>models.py</em>:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlalchemy</span> <span class="k">as</span> <span class="nn">sa</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">Division</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Division of a company.&quot;&quot;&quot;</span>

    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;division&quot;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">String</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Employee</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Person that works for a company.&quot;&quot;&quot;</span>

    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;employee&quot;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">String</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">division</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">orm</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Division&quot;</span><span class="p">)</span>
    <span class="n">division_id</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">sa</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;division.id&quot;</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="nullable">
<span id="many-to-one-nullable"></span><h3>Nullable<a class="headerlink" href="#nullable" title="Permalink to this headline">¶</a></h3>
<p>Similar to simple value columns (such as <em>integer</em>), many to one relationships
are also nullable. This is supported using the <em>nullable</em> key or by including
the property in the <em>required</em> array of the schema. There are 2 places where
the <em>nullable</em> key can be defined. The recommended implementation adds it using
<em>allOf</em>:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">Division</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="nt">Employee</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="l l-Scalar l-Scalar-Plain">division</span><span class="p p-Indicator">:</span>
      <span class="nt">allOf</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;$ref&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;#/components/schemas/Division&quot;</span>
        <span class="p p-Indicator">-</span> <span class="nt">nullable</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div>
</td></tr></table></div>
<p>Note that, when <em>allOf</em> is used, there must be exactly one <em>$ref</em> in the list
and at most one <em>nullable</em> in the list.</p>
<p>The other way, which is not recommended, adds <em>nullable</em> to the object being
referenced:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">Division</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="l l-Scalar l-Scalar-Plain">nullable</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="nt">Employee</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="l l-Scalar l-Scalar-Plain">division</span><span class="p p-Indicator">:</span>
      <span class="s">&quot;$ref&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;#/components/schemas/Division&quot;</span>
</pre></div>
</td></tr></table></div>
<p>The reason it is not recommended is because this only allows a <em>nullable</em> per
table, whereas the other allows for many. Also, some relationships do not
support <em>nullable</em> which means an error is raised when that type of
relationship refers to the same schema. If <em>nullable</em> is both in the <em>allOf</em>
list and the referenced object, the value from the <em>allOf</em> list will be used.</p>
<p>The following example makes the relationship not nullable using the required
array:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">Division</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="nt">Employee</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="l l-Scalar l-Scalar-Plain">division</span><span class="p p-Indicator">:</span>
      <span class="s">&quot;$ref&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;#/components/schemas/Division&quot;</span>
  <span class="nt">required</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">division</span>
</pre></div>
</td></tr></table></div>
<p>Note that if you use both the nullable and required method, nullable takes
precedence over required.</p>
<p>Setting <em>nullable</em> to <em>false</em> is equivalent to the following traditional
<em>models.py</em>:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlalchemy</span> <span class="k">as</span> <span class="nn">sa</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">Division</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Division of a company.&quot;&quot;&quot;</span>

    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;division&quot;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">String</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Employee</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Person that works for a company.&quot;&quot;&quot;</span>

    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;employee&quot;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">String</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">division_id</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">sa</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;division.id&quot;</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="null.html#null"><span class="std std-ref">Setting the Nullable Property</span></a> shows how nullable works for simple values such as integers.</p>
</div>
</div>
<div class="section" id="backref">
<span id="id2"></span><h3>Backref<a class="headerlink" href="#backref" title="Permalink to this headline">¶</a></h3>
<p>One of the features of <em>SQLAlchemy</em> is that a relationship can be back
populated to the referred table. This is supported using the <em>x-backref</em>
key. There are 2 places where the <em>x-backref</em> key can be defined. The
recommended implementation adds it using <em>allOf</em>:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">Division</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="nt">Employee</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="l l-Scalar l-Scalar-Plain">division</span><span class="p p-Indicator">:</span>
      <span class="nt">allOf</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;$ref&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;#/components/schemas/Division&quot;</span>
        <span class="p p-Indicator">-</span> <span class="nt">x-backref</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">employees</span>
</pre></div>
</td></tr></table></div>
<p>Note that, when <em>allOf</em> is used, there must be exactly one <em>$ref</em> in the list
and at most one <em>x-backref</em> in the list.</p>
<p>The other way, which is not recommended, adds the <em>x-backref</em> to the object
being referenced:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">Division</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="l l-Scalar l-Scalar-Plain">x-backref</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">employees</span>
<span class="nt">Employee</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="l l-Scalar l-Scalar-Plain">division</span><span class="p p-Indicator">:</span>
      <span class="s">&quot;$ref&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;#/components/schemas/Division&quot;</span>
</pre></div>
</td></tr></table></div>
<p>The reason it is not recommended is because this only allows a <em>x-backref</em> per
table, whereas the other allows for many. If <em>x-backref</em> is both in the <em>allOf</em>
list and the referenced object, the value from the <em>allOf</em> list will be used.</p>
<p>Using <em>x-backref</em> is equivalent to the following traditional <em>models.py</em>:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlalchemy</span> <span class="k">as</span> <span class="nn">sa</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">Division</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Division of a company.&quot;&quot;&quot;</span>

    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;division&quot;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">String</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Employee</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Person that works for a company.&quot;&quot;&quot;</span>

    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;employee&quot;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">String</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">division</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">orm</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Division&quot;</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s2">&quot;employees&quot;</span><span class="p">)</span>
    <span class="n">division_id</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">sa</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;division.id&quot;</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="references.html#references"><span class="std std-ref">References</span></a> shows how to reference to other schemas.</p>
</div>
</div>
<div class="section" id="custom-foreign-key">
<span id="id3"></span><h3>Custom Foreign Key<a class="headerlink" href="#custom-foreign-key" title="Permalink to this headline">¶</a></h3>
<p>The  <em>x-foreign-key-column</em> extension property is used to define a different
foreign key constraint column to the default <em>id</em> column. It is similar to the
<a class="reference internal" href="#backref"><span class="std std-ref">Backref</span></a> extension property. There are two ways the foreign key constrain
can be defined. The first adds the <em>x-foreign-key-column</em> extension property
using <em>allOf</em> which allows for a different foreign key column for each
relationship:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">Division</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="nt">Employee</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="l l-Scalar l-Scalar-Plain">division</span><span class="p p-Indicator">:</span>
      <span class="nt">allOf</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;$ref&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;#/components/schemas/Division&quot;</span>
        <span class="p p-Indicator">-</span> <span class="nt">x-foreign-key-column</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">name</span>
</pre></div>
</td></tr></table></div>
<p>The second adds the extension property on the referenced object:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">Division</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="l l-Scalar l-Scalar-Plain">x-foreign-key-column</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">name</span>
<span class="nt">Employee</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="l l-Scalar l-Scalar-Plain">division</span><span class="p p-Indicator">:</span>
      <span class="s">&quot;$ref&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;#/components/schemas/Division&quot;</span>
</pre></div>
</td></tr></table></div>
<p>This allows for a common definition for the foreign key constraint for all
relationships referencing the same object. If <em>x-foreign-key-column</em> is both in
the <em>allOf</em> list and the referenced object, the value from the <em>allOf</em> list
will be used.</p>
<p>It is also possible to define a property with the name that would otherwise be
automatically generated by <em>OpenAlchemy</em> to have more control over how the
foreign key property is defined. For example:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">Division</span><span class="p">:</span>
  <span class="nt">x-tablename</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">division</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="nt">properties</span><span class="p">:</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="l l-Scalar l-Scalar-Plain">id</span><span class="p p-Indicator">:</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
<span class="nt">Employee</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="l l-Scalar l-Scalar-Plain">division</span><span class="p p-Indicator">:</span>
      <span class="s">&quot;$ref&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;#/components/schemas/Division&quot;</span>
    <span class="nt">division_id</span><span class="p">:</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
      <span class="nt">x-foreign-key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">division.id</span>
</pre></div>
</td></tr></table></div>
<p>Note the following:</p>
<ul class="simple">
<li><p>When <em>OpenAlchemy</em> constructs the foreign key for you, the name of the
property is made up of the name of the property referencing the object
(<em>division</em> in the previous example) combined with the name of the property
in the foreign key constraint (<em>id</em> in the previous example). These two
values are combined as follows:
“&lt;reference property name&gt;_&lt;foreign key column name&gt;” (<em>division_id</em> in the
previous example).</p></li>
<li><p>If <em>OpenAlchemy</em> finds that property in the schema, it won’t construct a
foreign key property automatically.</p></li>
<li><p>The defined property is type checked against the expected foreign key type
based on the relationship.</p></li>
<li><p>The defined property is checked for the <em>x-foreign-key</em> property against the
expected foreign key constraint based on the relationship.</p></li>
<li><p>The <em>x-foreign-key-column</em> extension property can be used to control which
property is used as the foreign key.</p></li>
<li><p>When the foreign key is defined, the <em>from_dict</em> and <em>to_dict</em> model
functions will use/return the foreign key values.</p></li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<ul class="simple">
<li><p><a class="reference internal" href="column_modifiers.html#foreign-key"><span class="std std-ref">Foreign Key Constraint</span></a> describes how to define foreign key constraints.</p></li>
<li><p><a class="reference internal" href="../index.html#from-dict"><span class="std std-ref">from_dict</span></a> describes how to convert dictionaries to model instances.</p></li>
<li><p><a class="reference internal" href="../index.html#to-dict"><span class="std std-ref">to_dict</span></a> describes how to convert model instances to dictionaries.</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="one-to-one">
<span id="id4"></span><h2>One to One<a class="headerlink" href="#one-to-one" title="Permalink to this headline">¶</a></h2>
<p>A one to one relationship associates one child with one parent and vice-versa.
For example, the pay information for an employee may be stored in a different
table than the employee. However, one employee can only be paid in one way
and each employee must be paid separately. This means that there is a one to
one relationship between an employee and pay information.</p>
<p>The one to one relationship is defined in the same way as the
<a class="reference internal" href="#many-to-one"><span class="std std-ref">many to one</span></a> relationship except that it requires the
<em>x-uselist</em> extension property to be set to <em>False</em> and
<a class="reference internal" href="#backref"><span class="std std-ref">x-backref</span></a> to be defined.
<a class="reference internal" href="#custom-foreign-key"><span class="std std-ref">Custom foreign keys</span></a> and
<a class="reference internal" href="#many-to-one-nullable"><span class="std std-ref">nullable</span></a> are also supported. The <em>x-uselist</em>
property can be defined along with the <em>x-backref</em> extension property using
<em>allOf</em> or on the object being referenced. To define it on <em>allOf</em>:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">PayInfo</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="nt">Employee</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="l l-Scalar l-Scalar-Plain">pay_info</span><span class="p p-Indicator">:</span>
      <span class="nt">allOf</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;$ref&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;#/components/schemas/PayInfo&quot;</span>
        <span class="p p-Indicator">-</span> <span class="nt">x-backref</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">employee</span>
          <span class="nt">x-uselist</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div>
</td></tr></table></div>
<p>This is the recommended approach as it allows for other relationships to the
referenced object to be, for example, many to one relationships. For some types
of relationships the inclusion of <em>x-uselist</em> causes an error to be raised. To
default relationships to an object to one to one, the <em>x-uselist</em> property can
be set on the referenced object:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">PayInfo</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="l l-Scalar l-Scalar-Plain">x-backref</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">employee</span>
  <span class="nt">x-uselist</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="nt">Employee</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="l l-Scalar l-Scalar-Plain">division</span><span class="p p-Indicator">:</span>
      <span class="s">&quot;$ref&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;#/components/schemas/PayInfo&quot;</span>
</pre></div>
</td></tr></table></div>
<p>If <em>x-uselist</em> is both in  the <em>allOf</em> list and the referenced object, the
value from the <em>allOf</em> list will be used. The <em>x-uselist</em> and <em>x-backref</em>
properties don’t have to be defined together, they can be separated. For
example:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">PayInfo</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="l l-Scalar l-Scalar-Plain">x-backref</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">employee</span>
<span class="nt">Employee</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="l l-Scalar l-Scalar-Plain">pay_info</span><span class="p p-Indicator">:</span>
      <span class="nt">allOf</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;$ref&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;#/components/schemas/PayInfo&quot;</span>
        <span class="p p-Indicator">-</span> <span class="nt">x-uselist</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div>
</td></tr></table></div>
<p>Other permutations are also supported.</p>
</div>
<div class="section" id="one-to-many">
<span id="id5"></span><h2>One to Many<a class="headerlink" href="#one-to-many" title="Permalink to this headline">¶</a></h2>
<p>The one to many relationship is similar to the may to one relationship except
that the role of the child and parent is swapped. Following on from the
<a class="reference internal" href="#many-to-one"><span class="std std-ref">many to one</span></a> example, in the one to many case the division
would be the parent and the employees the children. The following <em>OpenAPI</em>
specification snippet defines a one to many relationship:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">Division</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="l l-Scalar l-Scalar-Plain">employees</span><span class="p p-Indicator">:</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">array</span>
      <span class="nt">items</span><span class="p">:</span>
        <span class="s">&quot;$ref&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;#/components/schemas/Division&quot;</span>
<span class="nt">Employee</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</td></tr></table></div>
<p>The one to many relationship also supports back references and custom foreign
keys. They are defined similar to how they are defined for many to one
relationships. For back references see <a class="reference internal" href="#backref"><span class="std std-ref">many to one backref</span></a>
and for custom foreign keys see
<a class="reference internal" href="#custom-foreign-key"><span class="std std-ref">many to one custom foreign keys</span></a>. Note that
<em>x-uselist</em> is not supported as it does not make sense to turn a one to many
relationship defined as an OpenAPI array into a one to one relationship. Also
note that <a class="reference internal" href="#many-to-one-nullable"><span class="std std-ref">nullable</span></a> is not supported because the
foreign key is defined on the referenced schema. If the foreign key was not
nullable by default, then that schema cannot be constructed without the foreign
key. If you need to define a foreign key that is not nullable, add it as a
property on the referenced schema and refer to that property using
<a class="reference internal" href="#custom-foreign-key"><span class="std std-ref">many to one custom foreign keys</span></a>.</p>
<div class="admonition note" id="dict-ignore">
<p class="admonition-title">Note</p>
<p>To be able to support one to many relationships, the schemas stored
with the model factory may be modified by putting a particular schema
behind an <em>allOf</em> statement together with a object that has a foreign key
property. The schema for the added object will include the <em>x-dict-ignore</em>
extension property to ensure that <em>from_dict</em> and <em>to_dict</em> don’t attempt
to construct the foreign key associated with the one to many relationship.
The <em>x-dict-ignore</em> extension property is an internal extension property
that may change at any time and should not be used externally.</p>
</div>
</div>
<div class="section" id="many-to-many">
<span id="id6"></span><h2>Many to Many<a class="headerlink" href="#many-to-many" title="Permalink to this headline">¶</a></h2>
<p>The many to many relationship is used when a parent model can have many
children but the child can also have many parents. For example, an employee
could be working on multiple projects and multiple employees are generally
assigned to a project. Therefore, there is a many to many relationship between
employees and projects. This is implemented using an association table which
has a column for each primary key on the parent and child. One row in the
association table implies a relationship between the parent and child.</p>
<p>Many to many relationships are defined similar to
<a class="reference internal" href="#one-to-many"><span class="std std-ref">one to many</span></a> relationships except that the <em>x-secondary</em>
extension property is required to define the name of the association table.
Both the parent and child must have a primary key column and, currently, both
the parent and child must only have one primary key column. In the presence of
the <em>x-secondary</em> extension property, a table with the name as the property
value is constructed where the columns are defined based on the schema of the
primary key columns of the parent and child. The names of the columns are
defined to be “&lt;<em>x-tablename</em>&gt;_&lt;property name&gt;”. Each column is given a
foreign key constraint as defined by “&lt;<em>x-tablename</em>&gt;.&lt;property name&gt;”.</p>
<p>There are 2 places where the <em>x-secondary</em> key
can be defined. The recommended implementation adds it using <em>allOf</em>:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">Project</span><span class="p">:</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">object</span>
  <span class="nt">x-tablename</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">project</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="nt">properties</span><span class="p">:</span>
    <span class="nt">id</span><span class="p">:</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
      <span class="nt">x-primary-key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="nt">Employee</span><span class="p">:</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">object</span>
  <span class="nt">x-tablename</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">employee</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="nt">properties</span><span class="p">:</span>
    <span class="nt">id</span><span class="p">:</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
      <span class="nt">x-primary-key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="nt">projects</span><span class="p">:</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">array</span>
      <span class="nt">items</span><span class="p">:</span>
        <span class="nt">allOf</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;$ref&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;#/components/schemas/Project&quot;</span>
          <span class="p p-Indicator">-</span> <span class="nt">x-secondary</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">employee_project</span>
</pre></div>
</td></tr></table></div>
<p>Note that, when <em>allOf</em> is used, there must be exactly one <em>$ref</em> in the list
and at most one <em>x-secondary</em> in the list. The other way, which is not
recommended, adds the <em>x-secondary</em> to the object being referenced:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">Project</span><span class="p">:</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">object</span>
  <span class="nt">x-tablename</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">project</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="nt">x-secondary</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">employee_project</span>
  <span class="nt">properties</span><span class="p">:</span>
    <span class="nt">id</span><span class="p">:</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
      <span class="nt">x-primary-key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="nt">Employee</span><span class="p">:</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">object</span>
  <span class="nt">x-tablename</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">employee</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="nt">properties</span><span class="p">:</span>
    <span class="nt">id</span><span class="p">:</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
      <span class="nt">x-primary-key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="nt">projects</span><span class="p">:</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">array</span>
      <span class="nt">items</span><span class="p">:</span>
        <span class="s">&quot;$ref&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;#/components/schemas/Project&quot;</span>
</pre></div>
</td></tr></table></div>
<p>The reason it is not recommended is because this only allows a <em>x-secondary</em>
per table, whereas the other allows for many. If <em>x-secondary</em> is both in the
<em>allOf</em> list and the referenced object, the value from the <em>allOf</em> list will be
used.</p>
<p>Using <em>x-secondary</em> is equivalent to the following traditional <em>models.py</em>:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlalchemy</span> <span class="k">as</span> <span class="nn">sa</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>


<span class="n">employee_project</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;employee_project&quot;</span><span class="p">,</span>
    <span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
    <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s2">&quot;project_id&quot;</span><span class="p">,</span> <span class="n">sa</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">sa</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;project.id&quot;</span><span class="p">)),</span>
    <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s2">&quot;employee_id&quot;</span><span class="p">,</span> <span class="n">sa</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">sa</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;employee.id&quot;</span><span class="p">)),</span>
<span class="p">)</span>


<span class="k">class</span> <span class="nc">Project</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A large sized business objective.&quot;&quot;&quot;</span>

    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;project&quot;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">String</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Employee</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Person that works for a company.&quot;&quot;&quot;</span>

    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;employee&quot;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">String</span><span class="p">)</span>
    <span class="n">projects</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">orm</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Project&quot;</span><span class="p">,</span> <span class="n">secondary</span><span class="o">=</span><span class="s2">&quot;project_employee&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Many to many relationships support <em>x-backref</em>, see
<a class="reference internal" href="#backref"><span class="std std-ref">many to one backref</span></a>. Note that <em>x-uselist</em> is not supported as
it does not make sense to turn a many to many relationship defined as an
OpenAPI array into a many to one relationship. Also, because the association
table is defined based on the primary key properties, custom foreign keys are
not supported.</p>
</div>
<div class="section" id="including-parent-references-with-child">
<span id="child-parent-reference"></span><h2>Including Parent References with Child<a class="headerlink" href="#including-parent-references-with-child" title="Permalink to this headline">¶</a></h2>
<p>So far, relationships have been used to include the full details for a child
with a parent. This is only possible from one side of the relationship without
circular references that would produce infinite sized API response payloads.
This can be overcome by including a subset of parent properties in the child.</p>
<p>This is done using <em>readOnly</em> properties. At a high level, properties marked as
<em>readOnly</em> are not constructed as columns in the <em>SQLAlchemy</em> models. They are
also not constructed as a part of a call to <em>from_dict</em>. The purpose of
<em>readOnly</em> properties is to include some of the properties of the parent in the
child dictionary when calling <em>to_dict</em>. <em>readOnly</em> properties are required to
be defined as objects or arrays of object. In both cases object properties may
not be of type object nor array to avoid circular references. <em>$ref</em> and
<em>allOf</em> are supported as normal.</p>
<div class="section" id="id7">
<h3>Many to One<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>For example, the following <em>Division</em> schema includes the <em>id</em> of all employees
working in the division as an array:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">Employee</span><span class="p">:</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">object</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="nt">properties</span><span class="p">:</span>
    <span class="nt">id</span><span class="p">:</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="nt">division</span><span class="p">:</span>
      <span class="nt">$ref</span><span class="p">:</span> <span class="s">&quot;#/../Division&quot;</span>
<span class="nt">Division</span><span class="p">:</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">object</span>
  <span class="nt">x-tablename</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">division</span>
  <span class="nt">properties</span><span class="p">:</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="l l-Scalar l-Scalar-Plain">employees</span><span class="p p-Indicator">:</span>
      <span class="nt">readOnly</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">array</span>
      <span class="nt">items</span><span class="p">:</span>
        <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">object</span>
        <span class="nt">properties</span><span class="p">:</span>
          <span class="nt">id</span><span class="p">:</span>
            <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
</pre></div>
</td></tr></table></div>
<p>Querying for a <em>Division</em> would, for example, result in the following
dictionary:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">division</span> <span class="o">=</span> <span class="n">Division</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">division</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="go">{&#39;id&#39;: 1, &#39;name&#39;: &#39;Engineering&#39;, &#39;employees&#39;: [{&#39;id&#39;: 1}, {&#39;id&#39;: 2}, [&#39;id&#39;: 5}]}</span>
</pre></div>
</div>
<p>Indicating that employees with the ids <em>1</em>, <em>2</em> and <em>5</em> work in the
engineering division. To retrieve further details for those employees, the
relevant endpoints can be queried with the ids.</p>
<p>Any number of properties may be included in the <em>readOnly</em> object schema.
Schema duplication can be reduced by making use of <em>$ref</em>. For example:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">BaseEmployee</span><span class="p">:</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">object</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="nt">properties</span><span class="p">:</span>
    <span class="nt">id</span><span class="p">:</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="nt">Employee</span><span class="p">:</span>
  <span class="nt">allOf</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">$ref</span><span class="p">:</span> <span class="s">&quot;#/.../BaseEmployee&quot;</span>
    <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">object</span>
      <span class="nt">properties</span><span class="p">:</span>
        <span class="nt">division</span><span class="p">:</span>
          <span class="nt">$ref</span><span class="p">:</span> <span class="s">&quot;#/../Division&quot;</span>
<span class="nt">Division</span><span class="p">:</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">object</span>
  <span class="nt">x-tablename</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">division</span>
  <span class="nt">properties</span><span class="p">:</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="l l-Scalar l-Scalar-Plain">employees</span><span class="p p-Indicator">:</span>
      <span class="nt">readOnly</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">array</span>
      <span class="nt">items</span><span class="p">:</span>
        <span class="nt">$ref</span><span class="p">:</span> <span class="s">&quot;#/../BaseEmployee&quot;</span>
</pre></div>
</td></tr></table></div>
<p>This means that all <em>Employee</em> properties are included except for the reference
to <em>Division</em> to avoid circular references.</p>
<p>In the above example, there is a many to one relationship from <em>Employee</em> to
<em>Division</em>. The difference for other relationship types is the type of the
<em>readOnly</em> property.</p>
</div>
<div class="section" id="id8">
<h3>One to One<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>The difference between many to one and one to one is that the type of the
<em>readOnly</em> property is an object instead of an array.</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">Employee</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
    <span class="nt">id</span><span class="p">:</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="nt">pay_info</span><span class="p">:</span>
      <span class="nt">allOf</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">$ref</span><span class="p">:</span> <span class="s">&quot;#/.../PayInfo&quot;</span>
        <span class="p p-Indicator">-</span> <span class="nt">x-backref</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">employee</span>
          <span class="nt">x-uselist</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="nt">PayInfo</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="l l-Scalar l-Scalar-Plain">employee</span><span class="p p-Indicator">:</span>
      <span class="nt">readOnly</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">object</span>
      <span class="nt">properties</span><span class="p">:</span>
        <span class="nt">id</span><span class="p">:</span>
          <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
</pre></div>
</td></tr></table></div>
<p>Querying for a <em>PayInfo</em> would, for example, result in the following
dictionary:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pay_info</span> <span class="o">=</span> <span class="n">PayInfo</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pay_info</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="go">{&#39;id&#39;: 1, &#39;account&#39;: &#39;012 345&#39;, &#39;employee&#39;: {&#39;id&#39;: 1}}</span>
</pre></div>
</div>
<p>Indicating that the pay information is for the employee with an id of <em>1</em>.</p>
</div>
<div class="section" id="id9">
<h3>One to Many<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>Including a parent reference with a child for a one to many relationship is
very similar to the one to one relationship case. To illustrate, the following
schema redefines the relationship between <em>Employee</em> and <em>Division</em> so that the
<em>Division</em> is the parent resulting in a one to many relationship:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">Division</span><span class="p">:</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">object</span>
  <span class="nt">x-tablename</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">division</span>
  <span class="nt">properties</span><span class="p">:</span>
    <span class="nt">id</span><span class="p">:</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="nt">employees</span><span class="p">:</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">array</span>
      <span class="nt">items</span><span class="p">:</span>
        <span class="nt">$ref</span><span class="p">:</span> <span class="s">&quot;#/../Employee&quot;</span>
<span class="nt">Employee</span><span class="p">:</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">object</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="nt">properties</span><span class="p">:</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="l l-Scalar l-Scalar-Plain">division</span><span class="p p-Indicator">:</span>
      <span class="nt">readOnly</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">object</span>
      <span class="nt">properties</span><span class="p">:</span>
        <span class="nt">id</span><span class="p">:</span>
          <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
</pre></div>
</td></tr></table></div>
<p>Querying for an <em>Employee</em> would, for example, result in the following
dictionary:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">employee</span> <span class="o">=</span> <span class="n">Employee</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">employee</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="go">{&#39;id&#39;: 1, &#39;name&#39;: &#39;David Andersson&#39;, &#39;division&#39;: {&#39;id&#39;: 1}}</span>
</pre></div>
</div>
<p>Indicating that the employee is working in the division with an id of <em>1</em>.</p>
</div>
<div class="section" id="id10">
<h3>Many to Many<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>Including a parent reference with a child for a many to many relationship is
very similar to the many to one relationship case except that both sides are
defined as arrays. To illustrate, the following schema defines a many to many
relationship between <em>Employee</em> and <em>Project</em>:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">Employee</span><span class="p">:</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">object</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="nt">properties</span><span class="p">:</span>
    <span class="nt">id</span><span class="p">:</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
      <span class="nt">x-primary-key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="nt">projects</span><span class="p">:</span>
      <span class="nt">allOf</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">$ref</span><span class="p">:</span> <span class="s">&quot;#/.../Project&quot;</span>
        <span class="p p-Indicator">-</span> <span class="nt">x-backref</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">employees</span>
          <span class="nt">x-secondary</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">employee_project</span>
<span class="nt">Project</span><span class="p">:</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">object</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="nt">properties</span><span class="p">:</span>
    <span class="nt">id</span><span class="p">:</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
      <span class="nt">x-primary-key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="nt">employees</span><span class="p">:</span>
      <span class="nt">readOnly</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">array</span>
      <span class="nt">items</span><span class="p">:</span>
        <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">object</span>
        <span class="nt">properties</span><span class="p">:</span>
          <span class="nt">id</span><span class="p">:</span>
            <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
</pre></div>
</td></tr></table></div>
<p>Querying for an <em>Employee</em> would, for example, result in the following
dictionary:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">employee</span> <span class="o">=</span> <span class="n">Employee</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">employee</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="go">{&#39;id&#39;: 1, &#39;name&#39;: &#39;David Andersson&#39;, &#39;projects&#39;: [{&#39;id&#39;: 1}, {&#39;id&#39;: 2}]}</span>
</pre></div>
</div>
<p>Indicating that the employee is working on the projects with an id of <em>1</em> and
<em>2</em>. Querying for a <em>Project</em> would, for example, result in the following
dictionary:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">project</span> <span class="o">=</span> <span class="n">Project</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">project</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="go">{&#39;id&#39;: 1, &#39;name&#39;: &#39;Expand to the USA&#39;, &#39;employees&#39;: [{&#39;id&#39;: 1}, {&#39;id&#39;: 3}]}</span>
</pre></div>
</div>
<p>Indicating that the project is being worked on by the employees with an id of
<em>1</em> and <em>3</em>.</p>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Technical Details</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="type_mapping.html">Type Mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="column_modifiers.html">Applying Modifiers to Columns</a></li>
<li class="toctree-l2"><a class="reference internal" href="null.html">Setting the <em>Nullable</em> Property</a></li>
<li class="toctree-l2"><a class="reference internal" href="references.html">References</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Defining Relationships</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#many-to-one">Many to One</a></li>
<li class="toctree-l3"><a class="reference internal" href="#one-to-one">One to One</a></li>
<li class="toctree-l3"><a class="reference internal" href="#one-to-many">One to Many</a></li>
<li class="toctree-l3"><a class="reference internal" href="#many-to-many">Many to Many</a></li>
<li class="toctree-l3"><a class="reference internal" href="#including-parent-references-with-child">Including Parent References with Child</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="inheritance.html">Inheritance</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Examples</a></li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Technical Details</a><ul>
      <li>Previous: <a href="references.html" title="previous chapter">References</a></li>
      <li>Next: <a href="inheritance.html" title="next chapter">Inheritance</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/technical_details/relationships.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, David Andersson.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/technical_details/relationships.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>